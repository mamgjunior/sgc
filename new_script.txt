/* Script de criação da base de dados do sistema de gerênciamento de distribuidora de papelarias */

/* Criando os dominios da base de dados */

CREATE DOMAIN DMBAIRRO VARCHAR(40);
CREATE DOMAIN DMCEP CHAR(9);
CREATE DOMAIN DMCIDADE VARCHAR(40);
CREATE DOMAIN DMCNPJ VARCHAR(18);
CREATE DOMAIN DMCODIGO_CARGO INTEGER;
CREATE DOMAIN DMCODIGO_CATEGORIA INTEGER;
CREATE DOMAIN DMCODIGO_CLIENTE INTEGER;
CREATE DOMAIN DMCODIGO_DEPTO INTEGER;
CREATE DOMAIN DMCODIGO_DESCRICAO INTEGER;
CREATE DOMAIN DMCODIGO_FAMILIA INTEGER;
CREATE DOMAIN DMCODIGO_FORNECEDOR INTEGER;
CREATE DOMAIN DMCODIGO_GRUPO INTEGER;
CREATE DOMAIN DMCODIGO_INTERNO INTEGER;
CREATE DOMAIN DMCODIGO_MARCA INTEGER;
CREATE DOMAIN DMCOMPLEMENTO VARCHAR(20);
CREATE DOMAIN DMENDERECO VARCHAR(50);
CREATE DOMAIN DMESTADO CHAR(2);
CREATE DOMAIN DMESTOQUE INTEGER;
CREATE DOMAIN DMINSCR_ESTADUAL VARCHAR(15);
CREATE DOMAIN DMMATRICULA CHAR(5);
CREATE DOMAIN DMNOME VARCHAR(50);
CREATE DOMAIN DMNOME_FANTASIA VARCHAR(30);
CREATE DOMAIN DMNUMERO CHAR(5);
CREATE DOMAIN DMRAZAO_SOCIAL VARCHAR(50);
CREATE DOMAIN DMREGISTRO INTEGER;
CREATE DOMAIN DMTELEFONE VARCHAR(16);
CREATE DOMAIN DMVALOR DECIMAL (10,2);
CREATE DOMAIN DMHOME_PAGE VARCHAR(30);
CREATE DOMAIN DMCODIGO_PERFIL INTEGER;
CREATE DOMAIN DMCODIGO_USUARIO INTEGER;
CREATE DOMAIN DMNUMERO_PEDIDO INTEGER;

/* Criando tabelas da base de dados */

CREATE TABLE FORNECEDORES(
    CODIGO_FORNECEDOR DMCODIGO_FORNECEDOR NOT NULL,
	CNPJ DMCNPJ,
    RAZAO_SOCIAL DMRAZAO_SOCIAL,
    NOME_FANTASIA DMNOME_FANTASIA,
    ENDERECO DMENDERECO,
    NUMERO DMNUMERO,
    COMPLEMENTO DMCOMPLEMENTO,
    BAIRRO DMBAIRRO,
    CIDADE DMCIDADE,
    ESTADO DMESTADO,
    CEP DMCEP,
    INSCRICAO_ESTADUAL DMINSCR_ESTADUAL,
    TELEFONE DMTELEFONE,
    CONTATO_COMERCIAL DMNOME,
	EMAIL DMEMAIL,
	HOME_PAGE DMHOME_PAGE,
	FAX DMTELEFONE,
	FONE_COMERCIAL DMTELEFONE,
    CONSTRAINT pk_fornecedores PRIMARY KEY(CODIGO_FORNECEDOR)
);

CREATE TABLE GRUPO_PRODUTOS(
    CODIGO_GRUPO DMCODIGO_GRUPO NOT NULL,
    DESCRICAO_GRUPO VARCHAR(30),
    CONSTRAINT pk_grupo_produtos PRIMARY KEY(CODIGO_GRUPO)
);

CREATE TABLE CATEGORIA_PRODUTOS(
    CODIGO_CATEGORIA DMCODIGO_CATEGORIA NOT NULL, 
    DESCRICAO_CATEGORIA VARCHAR(30),
    CONSTRAINT pk_categoria_produtos PRIMARY KEY(CODIGO_CATEGORIA)
);

CREATE TABLE FAMILIA_PRODUTOS(
    CODIGO_FAMILIA DMCODIGO_FAMILIA NOT NULL,
    DESCRICAO_FAMILIA VARCHAR(30),
    CONSTRAINT pk_familia_produtos PRIMARY KEY(CODIGO_FAMILIA)
);

CREATE TABLE MARCA_PRODUTOS(
    CODIGO_MARCA DMCODIGO_MARCA NOT NULL,
    DESCRICAO_MARCA VARCHAR(30),
    CONSTRAINT pk_marca_produtos PRIMARY KEY(CODIGO_MARCA)
);

CREATE TABLE DESCRICAO_PRODUTOS(
    CODIGO_DESCRICAO DMCODIGO_DESCRICAO NOT NULL,
    DESCRICAO VARCHAR(30),
    CONSTRAINT pk_descricao_produtos PRIMARY KEY(CODIGO_DESCRICAO)
);

CREATE TABLE CATALOGO_PRODUTOS(
    CODIGO_INTERNO DMCODIGO_INTERNO NOT NULL,
    CODIGO_BARRAS VARCHAR(13),
    CODIGO_DESCRICAO DMCODIGO_DESCRICAO,
    MODELO VARCHAR(50),
    UNIDADE_MEDIDA CHAR(4),
    CODIGO_GRUPO DMCODIGO_GRUPO,
    CODIGO_CATEGORIA DMCODIGO_CATEGORIA,
    CODIGO_FAMILIA DMCODIGO_FAMILIA,
    CODIGO_MARCA DMCODIGO_MARCA,
    PRECO_CUSTO DMVALOR,
    ICMS DECIMAL(8,2),
    IPI DECIMAL(8,2),
    MARGEM_LUCRO DECIMAL(8,2),
    PRECO_VENDA DMVALOR,
    CONSUMO_MEDIO INTEGER,
    ESTOQUE_ATUAL DMESTOQUE,
    ESTOQUE_MINIMO DMESTOQUE,
    CONSTRAINT pk_catalogo_produtos PRIMARY KEY(CODIGO_INTERNO)
);

CREATE TABLE CLIENTES_JURIDICO(
    CODIGO_CLIENTE DMCODIGO_CLIENTE NOT NULL, 
    NOME_CLIENTE DMNOME,
    CNPJ DMCNPJ,
    INSCRICAO_ESTADUAL DMINSCR_ESTADUAL,
    ENDERECO DMENDERECO,
    NUMERO DMNUMERO,
    COMPLEMENTO DMCOMPLEMENTO,
    BAIRRO DMBAIRRO,
    CIDADE DMCIDADE,
    ESTADO DMESTADO,
    CEP DMCEP,
    TELEFONE DMTELEFONE,
    FAX DMTELEFONE,
    EMAIL VARCHAR(80),
    TELEFONE_CONTATO DMTELEFONE,
    CONTATO DMNOME,
    DATA_CADASTRO DATE, 
    LIMITE_CREDITO DMVALOR,
    VALOR_ABERTO DMVALOR,
    TIPO_COBRANCA CHAR(1),
    CONSTRAINT pk_clientes_juridico PRIMARY KEY(CODIGO_CLIENTE)
);

CREATE TABLE DEPARTAMENTOS(
    CODIGO_DEPARTAMENTO DMCODIGO_DEPTO NOT NULL,
    NOME_DEPARTAMENTO VARCHAR(30),
    CONSTRAINT pk_departamentos PRIMARY KEY(CODIGO_DEPARTAMENTO)
);

CREATE TABLE CARGOS(
    CODIGO_CARGO DMCODIGO_CARGO NOT NULL,
    DESCRICAO_CARGO VARCHAR(40),
    VENDEDOR_EXTERNO CHAR(1),
    VENDEDOR_INTERNO CHAR(1),
    CONSTRAINT pk_cargos PRIMARY KEY(CODIGO_CARGO)
);

CREATE TABLE FUNCIONARIOS(
    MATRICULA_FUNCIONARIO DMMATRICULA NOT NULL,
    NOME_FUNCIONARIO DMNOME,
    ENDERECO DMENDERECO,
    NUMERO DMNUMERO,
    COMPLEMENTO DMCOMPLEMENTO,
    BAIRRO DMBAIRRO,
    CIDADE DMCIDADE,
    ESTADO DMESTADO,
    CEP DMCEP,
    TELEFONE DMTELEFONE,
    EMAIL VARCHAR(80),
    CODIGO_DEPARTAMENTO DMCODIGO_DEPTO,
    CODIGO_CARGO DMCODIGO_CARGO,
    CONSTRAINT pk_funcionarios PRIMARY KEY(MATRICULA_FUNCIONARIO),
    CONSTRAINT fk_funcionarios_departamentos FOREIGN KEY(CODIGO_DEPARTAMENTO) REFERENCES DEPARTAMENTOS(CODIGO_DEPARTAMENTO),
    CONSTRAINT fk_funcionarios_cargos FOREIGN KEY(CODIGO_CARGO) REFERENCES CARGOS(CODIGO_CARGO)
);

CREATE TABLE FORNECEDOR_PRODUTO(
    REGISTRO DMREGISTRO NOT NULL,
    CODIGO_FORNECEDOR DMCODIGO_FORNECEDOR,
    FORNECEDOR VARCHAR(30),
    CODIGO_PRODUTO DMCODIGO_INTERNO,
    DESCRICAO_PRODUTO VARCHAR(80),
    CONSTRAINT pk_fornecedor_produto PRIMARY KEY(REGISTRO)
);

CREATE TABLE CONTROLE_SEQUENCIA(
    registro CHAR(1) NOT NULL,
    codigo_cargo DMCODIGO_CARGO,
    codigo_interno DMCODIGO_INTERNO,
    codigo_categoria DMCODIGO_CATEGORIA,
    codigo_cliente DMCODIGO_CLIENTE,
    codigo_departamento DMCODIGO_DEPTO,
    codigo_descricao DMCODIGO_DESCRICAO,
    codigo_familia DMCODIGO_FAMILIA,
    registro_fornecedor DMREGISTRO,
    codigo_fornecedor DMCODIGO_FORNECEDOR,
    codigo_grupo DMCODIGO_GRUPO,
    codigo_marca DMCODIGO_MARCA,
	codigo_perfil DMCODIGO_PERFIL,
    codigo_usuario DMCODIGO_USUARIO,
	registro_item_pedido INTEGER,
	numero_pedido INTEGER,
	registro_entrada_nf INTEGER,
    CONSTRAINT pk_controle_sequencia PRIMARY KEY(registro)
)

CREATE TABLE ESTADOS(
    sigla_estado CHAR(2) NOT NULL,
    estado VARCHAR(40),
    CONSTRAINT pk_estados PRIMARY KEY(sigla_estado)
)

CREATE TABLE PERFIL_USUARIO(
    CODIGO_PERFIL DMCODIGO_PERFIL NOT NULL,
    DESCRICAO_PERFIL VARCHAR(25),
    CADASTRO_FORNECEDORES CHAR(1),
    CADASTRO_PRODUTOS CHAR(1),
    CADASTRO_CLIENTES CHAR(1),
    CADASTRO_FUNCIONARIOS CHAR(1),
    CADASTRO_USUARIOS CHAR(1),
	entrada_estoque CHAR(1),
	vendas CHAR(1),
    CONSTRAINT PK_PERFIL_USUARIO PRIMARY KEY(CODIGO_PERFIL)
);

CREATE TABLE USUARIOS(
    codigo_usuario DMCODIGO_USUARIO NOT NULL,
    codigo_funcionario DMMATRICULA,
    identificacao_usuario VARCHAR(15),
    senha_acesso VARCHAR(8),
    codigo_perfil DMCODIGO_PERFIL,
    CONSTRAINT pk_USUARIOS PRIMARY KEY(codigo_usuario)
);

CREATE TABLE CONTROLE_PEDIDOS(
    numero_pedido DMNUMERO_PEDIDO NOT NULL,
    data_pedido DATE,
    codigo_cliente DMCODIGO_CLIENTE,
    codigo_vendedor DMMATRICULA,
    valor_total DECIMAL(12,2),
    codicao_pagamento INTEGER,
    forma_entrada VARCHAR(50),
    CONSTRAINT pk_controle_pedidos PRIMARY KEY(numero_pedido)
);

CREATE TABLE ITENS_PEDIDO(
    registro DMREGISTRO NOT NULL,
    numero_pedido DMNUMERO_PEDIDO,
    numero_item INTEGER,
    codigo_interno DMCODIGO_INTERNO,
    descricao_produto VARCHAR(80),
    preco_unitario DECIMAL(8,2),
    quantidade INTEGER,
    preco_total DECIMAL(10,2),
    CONSTRAINT pk_itens_pedido PRIMARY KEY(registro)

);

CREATE TABLE ENTRADA_NF(
    registro DMREGISTRO NOT NULL,
    codigo_fornecedor DMCODIGO_FORNECEDOR,
    numero_nota_fiscal CHAR(6),
    codigo_produto DMCODIGO_INTERNO,
    descricao_produtos VARCHAR(80),
    quantidade INTEGER,
    preco_unitario DECIMAL(8,2),
    valor_total DECIMAL(10,2),
    CONSTRAINT pk_entrada_nf PRIMARY KEY(registro)
);


/*Criando usuário administrador do sistema*/
INSERT INTO usuarios(codigo_usuario, codigo_funcionario, identificacao_usuario, senha_acesso, codigo_perfil) VALUES (1, '99999', 'ADMSIS', '4DIVIS1S', 1);

